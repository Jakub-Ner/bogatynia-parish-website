---
import BaseLayout from "../layouts/BaseLayout.astro";
import PageHeader from "../components/Sections/PageHeader.astro";
import { getCollection } from "astro:content";
import { marked } from "marked";

// Get caritas articles sorted by date (newest first)
const caritasArticles = await getCollection("caritas", ({ data }) => !data.draft);
const sortedArticles = caritasArticles.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Format date helper
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat("pl-PL", {
    day: "numeric",
    month: "long",
    year: "numeric",
  }).format(date);
};
---

<BaseLayout
  title="Caritas - Parafia Św. Marii Magdaleny"
  description="Parafialny Zespół Caritas w Bogatyni - pomoc dla potrzebujących, współpraca z MOPS, dystrybucja darów żywnościowych z UE."
>
  <PageHeader
    title="Parafialny Zespół Caritas"
    subtitle="Miłość w działaniu"
    backgroundImage="/uploads/caritas-bg.webp"
  />

  <section class="py-16">
    <div class="container">
      <div class="max-w-4xl mx-auto">

        <!-- Wprowadzenie -->
        <div class="bg-blue-50 rounded-lg p-8 mb-12">
          <div class="flex items-start">
            <div class="flex-shrink-0 mt-1">
              <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              </div>
            </div>
            <div class="ml-4">
              <h2 class="text-2xl font-bold mb-3 text-blue-800">O nas</h2>
              <p class="text-blue-700 text-lg leading-relaxed">
                Parafialny Zespół Caritas działa przy parafii Św. Marii Magdaleny w Bogatyni,
                niosąc pomoc materialną i duchową osobom znajdującym się w trudnej sytuacji życiowej.
                Nasze działania opierają się na miłości chrześcijańskiej i solidarności z najbardziej potrzebującymi.
              </p>
            </div>
          </div>
        </div>

        <!-- Nasze działania -->
        <div class="mb-12">
          <h2 class="text-3xl font-bold mb-8 text-center">Nasze działania</h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

            <!-- Dystrybucja darów z UE -->
            <div class="bg-white rounded-lg shadow-lg p-6">
              <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                  </svg>
                </div>
                <h3 class="text-xl font-bold text-green-700">Dary żywnościowe z UE</h3>
              </div>
              <p class="text-gray-700 mb-4">
                Regularnie dystrybuujemy dary żywnościowe z programu FEnPŻ (Program Żywnościowej Pomocy
                Europejskiej). Wydawanie odbywa się w Domu Parafialnym według harmonogramu ogłaszanego
                w ogłoszeniach parafialnych.
              </p>
              <div class="bg-green-50 p-4 rounded-lg">
                <p class="text-sm text-green-700">
                  <strong>Kto może otrzymać pomoc:</strong> Osoby posiadające skierowanie z MOPS w Bogatyni
                </p>
              </div>
            </div>

            <!-- Zbiórki -->
            <div class="bg-white rounded-lg shadow-lg p-6">
              <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                  </svg>
                </div>
                <h3 class="text-xl font-bold text-orange-700">Zbiórki i akcje charytatywne</h3>
              </div>
              <p class="text-gray-700 mb-4">
                Organizujemy regularne zbiórki żywności, odzieży, środków higieny i innych artykułów
                pierwszej potrzeby. Prowadzimy też specjalne akcje, jak np. zbiórka na wywóz śmieci
                z cmentarza parafialnego.
              </p>
              <div class="bg-orange-50 p-4 rounded-lg">
                <p class="text-sm text-orange-700">
                  <strong>Jak pomóc:</strong> Informacje o bieżących zbiórkach znajdziesz w ogłoszeniach parafialnych
                </p>
              </div>
            </div>

            <!-- Wsparcie duchowe -->
            <div class="bg-white rounded-lg shadow-lg p-6">
              <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10v11M20 10v11" />
                  </svg>
                </div>
                <h3 class="text-xl font-bold text-purple-700">Wsparcie duchowe</h3>
              </div>
              <p class="text-gray-700 mb-4">
                Oprócz pomocy materialnej oferujemy wsparcie duchowe poprzez modlitwę, rozmowy
                duszpasterskie i włączenie potrzebujących w życie wspólnoty parafialnej.
              </p>
              <div class="bg-purple-50 p-4 rounded-lg">
                <p class="text-sm text-purple-700">
                  <strong>Kontakt:</strong> Ks. Proboszcz lub kancelaria parafialna
                </p>
              </div>
            </div>

            <!-- Współpraca z MOPS -->
            <div class="bg-white rounded-lg shadow-lg p-6">
              <div class="flex items-center mb-4">
                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                  </svg>
                </div>
                <h3 class="text-xl font-bold text-blue-700">Współpraca z MOPS</h3>
              </div>
              <p class="text-gray-700 mb-4">
                Ściśle współpracujemy z Miejskim Ośrodkiem Pomocy Społecznej w Bogatyni,
                co pozwala nam dotrzeć do osób najbardziej potrzebujących i udzielać
                pomocy w sposób skoordynowany.
              </p>
              <div class="bg-blue-50 p-4 rounded-lg">
                <p class="text-sm text-blue-700">
                  <strong>MOPS Bogatynia:</strong> ul. Daszyńskiego 1, tel. 75 778 42 30
                </p>
              </div>
            </div>

          </div>
        </div>

        <!-- Aktualności Caritas -->
        {sortedArticles.length > 0 && (
          <div class="mb-12">
            <h2 class="text-3xl font-bold mb-8 text-center">Aktualności</h2>
            <div class="space-y-6">
              {sortedArticles.map(async (article) => {
                const htmlContent = await marked(article.body || "");
                return (
                  <article class="bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-red-600 to-red-700 px-6 py-3">
                      <div class="flex flex-wrap items-center justify-between gap-2">
                        <h3 class="text-lg md:text-xl font-bold text-white">
                          {article.data.title}
                        </h3>
                      </div>
                    </div>
                    <div class="p-6 prose prose-sm max-w-none" set:html={htmlContent} />
                  </article>
                );
              })}
            </div>
          </div>
        )}

        <!-- Fundusze Europejskie na Pomoc Żywnościową -->
        <div class="mb-12">
          <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="bg-gradient-to-r from-blue-600 to-blue-800 px-6 py-4">
              <h2 class="text-xl md:text-2xl font-bold text-white text-center">
                Fundusze Europejskie na Pomoc Żywnościową 2021-2027
              </h2>
              <p class="text-blue-100 text-center text-sm mt-1">
                Okres realizacji: grudzień 2024 - wrzesień 2025
              </p>
            </div>
            <div class="p-4 md:p-6 flex flex-col items-center">
              <button
                id="open-image-modal"
                class="cursor-zoom-in hover:opacity-90 transition-opacity focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-lg"
                aria-label="Otwórz plakat w pełnym rozmiarze"
              >
                <img
                  src="/uploads/fundusze-europejskie-pomoc-zywnosciowa-2024-2025.png"
                  alt="Plakat informacyjny - Fundusze Europejskie na Pomoc Żywnościową 2021-2027. Kryterium dochodowe: 2676,50 zł dla osoby samotnej, 2180,95 zł dla osoby w rodzinie. Lista produktów spożywczych dostępnych w ramach programu."
                  class="max-h-[400px] w-auto rounded-lg shadow-sm"
                  loading="lazy"
                />
              </button>
              <p class="text-center text-gray-500 text-sm mt-3">
                Kliknij na plakat, aby powiększyć
              </p>
            </div>
          </div>
        </div>

        <!-- Image Modal -->
        <div
          id="image-modal"
          class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80 backdrop-blur-sm p-4"
          role="dialog"
          aria-modal="true"
          aria-label="Powiększony plakat"
        >
          <button
            id="close-modal"
            class="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors z-10"
            aria-label="Zamknij"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
          <div class="relative max-w-5xl max-h-[90vh] overflow-auto">
            <img
              src="/uploads/fundusze-europejskie-pomoc-zywnosciowa-2024-2025.png"
              alt="Plakat informacyjny - Fundusze Europejskie na Pomoc Żywnościową 2021-2027"
              class="max-w-full max-h-[90vh] object-contain rounded-lg"
            />
          </div>
        </div>

        <!-- Jak otrzymać pomoc -->
        <div class="bg-yellow-50 rounded-lg p-8 mb-12">
          <h2 class="text-2xl font-bold mb-6 text-yellow-800 text-center">Jak otrzymać pomoc?</h2>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="text-center">
              <div class="w-12 h-12 rounded-full bg-yellow-200 flex items-center justify-center mx-auto mb-3">
                <span class="text-xl font-bold text-yellow-800">1</span>
              </div>
              <h3 class="font-bold mb-2 text-yellow-800">Skontaktuj się z MOPS</h3>
              <p class="text-yellow-700 text-sm">
                Zgłoś się do Miejskiego Ośrodka Pomocy Społecznej w Bogatyni w celu otrzymania skierowania.
              </p>
            </div>

            <div class="text-center">
              <div class="w-12 h-12 rounded-full bg-yellow-200 flex items-center justify-center mx-auto mb-3">
                <span class="text-xl font-bold text-yellow-800">2</span>
              </div>
              <h3 class="font-bold mb-2 text-yellow-800">Przyjdź do parafii</h3>
              <p class="text-yellow-700 text-sm">
                Z otrzymanym skierowaniem zgłoś się do Domu Parafialnego w wyznaczonych terminach.
              </p>
            </div>

            <div class="text-center">
              <div class="w-12 h-12 rounded-full bg-yellow-200 flex items-center justify-center mx-auto mb-3">
                <span class="text-xl font-bold text-yellow-800">3</span>
              </div>
              <h3 class="font-bold mb-2 text-yellow-800">Otrzymaj pomoc</h3>
              <p class="text-yellow-700 text-sm">
                Nasi wolontariusze pomogą Ci w otrzymaniu odpowiedniej pomocy zgodnie z Twoimi potrzebami.
              </p>
            </div>
          </div>
        </div>

        <!-- Zostań wolontariuszem -->
        <div class="bg-red-50 rounded-lg p-8">
          <h2 class="text-2xl font-bold mb-6 text-red-800 text-center">Zostań wolontariuszem Caritas!</h2>

          <div class="text-center">
            <p class="text-red-700 text-lg mb-6">
            Szukamy osób chętnych do pomocy w naszej działalności charytatywnej.
            Nie są wymagane specjalne kwalifikacje - wystarczy chęć pomocy i serce otwarte na potrzeby innych.
            </p>

            <h2 class="text-2xl font-bold mb-6 text-red-800 text-center">Co możesz robić?</h2>
            <ul class="text-red-700 space-y-1 max-w-md mx-auto">
              <li>Wsparcie w dystrybucji darów i żywności</li>
              <li>Organizacja lokalnych zbiórek (np. żywności, sprzętu)</li>
              <li>Odwiedziny i towarzyszenie osobom starszym i samotnym</li>
              <li>Pomoc administracyjna w biurze lub przy wydarzeniach</li>
            </ul>
          </div>
        </div>


      </div>
    </div>
  </section>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const openBtn = document.getElementById('open-image-modal');
    const closeBtn = document.getElementById('close-modal');
    const modal = document.getElementById('image-modal');

    const openModal = () => {
      modal?.classList.remove('hidden');
      modal?.classList.add('flex');
      document.body.style.overflow = 'hidden';
    };

    const closeModal = () => {
      modal?.classList.add('hidden');
      modal?.classList.remove('flex');
      document.body.style.overflow = '';
    };

    openBtn?.addEventListener('click', openModal);
    closeBtn?.addEventListener('click', closeModal);

    // Close on backdrop click
    modal?.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal?.classList.contains('hidden')) {
        closeModal();
      }
    });
  });
</script>
